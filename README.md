# lifecraft-api
Lifecraft API

# Процесс

- Пользователь авторизовался первый раз, видит экранчик с выбором роли
  - НПС: тот, кто даёт и проверяет задания.
  - Герой: тот, кто выполняет задания.
  - Роли берутся из `player_roles`.
    - Возможно, в будущем добавятся роли 
      - Наблюдатель
      - Соратник
      - Соперник
      - т.п.
- Пользователь выбрал роль героя.
- Пользователь видит экранчик с выбором героя для старта.
  - Для отображения используются сущности `IHeroSample` из `hero_samples`.
- Пользователь выбирает героя.
  - Для каждого атрибута из болванки (сэмпла) создаётся экземпляр атрибута в хранилище `attributes`.
  - Создаётся новый экзмепляр `IHero` в `heroes`.
  - Пользователь видит сообщение о создании героя.
  - Пользователь видит сообщение, что необходимо найти НПСа - того, кто будет давать задания.
    - Пользователь видит поле для ввода юзернейма НПСа и поле с ссылкой для приглашения.
  - Пользователь вводит юзернейм НПСа и жмёт кнопку "Пригласить".
    - Пользователь видит сообщение, что приглашение отправлено и как только НПС откликнеться, игра станет доступна.
      - Пользователь видит разделы 
        - Магазин.
        - Навыки.
        - Постройки.
        - Артефакты.
        - Питомцы.
      - В этих разделах пользователь пока ничего не может сделать, кроме как полистать.
    - Пользователь видит сообщение, что НПС не найден.
      - Пользователь повторяет попытку.
      - Пользователь выбирает опцию "Я сам себе НПС".
        - У пользователя может быть несколько НПСов?
          - Да.
- НПС выдал задания и определил опасности/штрафы.
  - Создались записи:
    - `relations`: связь НПСа и Героя.
    - `tasks_samples`: набор заданий для Героя.
    - `dangers_samples`: набор опасностей для Героя.
    - `stories`: история изменений по герою, туда добавилась запись про появление НПСа.
      - Для создания записи использовался шаблон из `stories_samples`.
    - `achievements`: достижения Героя. Герой получил достижение "Наёмник" (найти НПСа).
      - Для создания записи использовался шаблон из `achievements_samples`.
      - Также для учётки НПСа создалась запись с обратным достижением "НПС" (найти наёмника).
    - `ranks`: звания Героя. Герой получил звание "Наёмник".
      - При выполнении определённых условий, герою добавляются звания - какое отображать из них герой решает сам.
- Пользователь героя видит разделы
  - Задания
  - Опасности
  - Магазин.
  - Навыки.
  - Постройки.
  - Артефакты.
  - Питомцы.
- Пользователь переходит в раздел задания.
  - Пользователь видит карточки с заданиями.
    - На каждой карточке информация:
      - Название.
      - Описание.
      - Стоимость.
      - Награда.
      - Кнопка "Выполнить".
  - Пользователь жмёт по "Выполнить" по задаче.
    - В `hero_tasks` создаётся запись со статусом "ждёт подтверждения от НПСа" и expired N дней.
      - Если в течение N дней НПС не подтвердит выполнение, то задача удаляется из `hero_tasks`, а в `hero_stats` в поле `not_approved` увеличивается значение на 1.
- НПС авторизуется и видит индикатор с количеством 1 в разделе "На подтверждение".
- НПС переходит в раздел и видит выполненую Героем задачу и кнопку "Подтвердить".
  - Задача берётся из `hero_tasks`.
- НПС жмёт "Подтвердить".
  - Задача в `hero_tasks` помечается как подтверждённая.
  - В `hero_stories` появляется новая запись.
  - Значение `approved` в `hero_stats` увеличивается на 1.
  - С Героя списывается оплата за задание.
    - Обновляются соответствующие атрибуты в `attributes`.
  - Герою начислятся награда.
    - Обновляются соответствующие атрибуты в `attributes`.
  - Срабатывает событие `lifecraft.hero.task.approved`.